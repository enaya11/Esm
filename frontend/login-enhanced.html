<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل الدخول - SmartCoin</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/auth.css">
    <link rel="stylesheet" href="css/3d-animations.css">
    <link rel="stylesheet" href="css/3d-effects-extra.css">
    <!-- تحميل مكتبة TON Connect SDK -->
    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js" defer></script>
    <!-- تحميل مكتبة TON Connect UI -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js" defer></script>
</head>
<body>
    <!-- شاشة التحميل -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-container">
            <div class="logo-container">
                <img src="img/logo.png" alt="SmartCoin Logo" class="logo">
            </div>
            <h1 class="welcome-title">مرحباً بك في <span class="highlight">SmartCoin</span></h1>
            <p class="welcome-subtitle">منصة العملات الرقمية المستقبلية بدعم رأس مال 350 مليون دولار!</p>
            
            <div class="login-container">
                <h2 class="login-title">تسجيل الدخول</h2>
                
                <div class="login-methods">
                    <!-- تسجيل الدخول عبر تليجرام -->
                    <div class="login-method telegram-login">
                        <button id="telegram-login-btn" class="login-btn telegram">
                            <img src="img/telegram-icon.png" alt="Telegram" class="login-icon">
                            <span>تسجيل الدخول عبر تليجرام</span>
                        </button>
                    </div>
                    
                    <!-- تسجيل الدخول عبر محفظة TON -->
                    <div class="login-method ton-login">
                        <button id="ton-login-btn" class="login-btn ton">
                            <img src="img/ton-icon.png" alt="TON Wallet" class="login-icon">
                            <span>تسجيل الدخول عبر محفظة TON</span>
                        </button>
                        <!-- عنصر TON Connect UI -->
                        <div id="ton-connect"></div>
                    </div>
                </div>
                
                <div class="login-info">
                    <p>قم بتسجيل الدخول للوصول إلى جميع ميزات المنصة</p>
                    <p style="margin-top: 10px;">
                        ليس لديك حساب؟ 
                        <a href="register.html" style="color: var(--sc-gold); text-decoration: none; font-weight: bold;">
                            إنشاء حساب جديد
                        </a>
                    </p>
                    <p class="small">بالتسجيل، أنت توافق على <a href="#">شروط الاستخدام</a> و <a href="#">سياسة الخصوصية</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- المحتوى الرئيسي (سيظهر بعد تسجيل الدخول) -->
    <div id="main-content" style="display: none;">
        <header>
            <div class="header-container">
                <div class="logo">
                    <img src="img/logo.png" alt="SmartCoin Logo">
                </div>
                <nav>
                    <ul>
                        <li><a href="earn-enhanced.html">التعدين</a></li>
                        <li><a href="tasks-enhanced.html">المهام</a></li>
                        <li><a href="referrals-enhanced.html">الإحالات</a></li>
                        <li><a href="wheel-enhanced.html">عجلة الحظ</a></li>
                    </ul>
                </nav>
                <div class="user-info">
                    <span class="balance"><span id="user-balance">0</span> SM</span>
                    <div class="user-menu">
                        <span id="user-name">مستخدم</span>
                        <div class="dropdown-menu">
                            <a href="profile-enhanced.html">الملف الشخصي</a>
                            <a href="#" id="logout-btn" class="logout-btn">تسجيل الخروج</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <div class="container">
                <div class="welcome-back">
                    <h1>مرحباً بعودتك، <span id="welcome-user-name">مستخدم</span>!</h1>
                    <p>تم تسجيل دخولك بنجاح. يمكنك الآن الوصول إلى جميع ميزات المنصة.</p>
                    
                    <div class="quick-actions">
                        <a href="earn-enhanced.html" class="action-btn">
                            <img src="img/mining-icon.png" alt="Mining">
                            <span>بدء التعدين</span>
                        </a>
                        <a href="tasks-enhanced.html" class="action-btn">
                            <img src="img/tasks-icon.png" alt="Tasks">
                            <span>إكمال المهام</span>
                        </a>
                        <a href="referrals-enhanced.html" class="action-btn">
                            <img src="img/referral-icon.png" alt="Referrals">
                            <span>دعوة الأصدقاء</span>
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- النوافذ المنبثقة -->
    <div id="popup-container" class="popup-container" style="display: none;">
        <div class="popup">
            <div class="popup-header">
                <h3 id="popup-title">عنوان النافذة</h3>
                <button id="popup-close" class="popup-close">&times;</button>
            </div>
            <div id="popup-content" class="popup-content">
                <!-- سيتم إضافة المحتوى ديناميكياً -->
            </div>
        </div>
    </div>

    <!-- سكريبت المصادقة -->
    <script src="js/auth.js"></script>
    <!-- سكريبت مصادقة تليجرام -->
    <script src="js/telegram-auth.js"></script>
    <!-- سكريبت مصادقة TON المحسن -->
    <script src="js/ton-connect-enhanced.js"></script>
    <!-- سكريبت الأتمتة ثلاثية الأبعاد -->
    <script src="js/3d-automation.js"></script>
    <!-- سكريبت التطبيق الرئيسي -->
    <script src="js/app.js"></script>
    
    <script>
        // تهيئة TON Connect UI
        document.addEventListener('DOMContentLoaded', function() {
            // إنشاء مثيل TON Connect UI
            const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'tonconnect-manifest.json',
                buttonRootId: 'ton-connect'
            });
            
            // تخصيص الخيارات
            tonConnectUI.uiOptions = {
                language: 'en', // اللغة الافتراضية
                theme: 'SYSTEM', // السمة (LIGHT, DARK, SYSTEM)
                uiPreferences: {
                    colorsSet: {
                        // تخصيص الألوان
                        accent: '#AEFF6A',
                        background: {
                            primary: '#18181B',
                            secondary: '#27272A'
                        }
                    }
                }
            };
            
            // إضافة مستمع للاتصال الناجح
            tonConnectUI.onStatusChange(wallet => {
                if (wallet) {
                    console.log('تم الاتصال بالمحفظة:', wallet);
                    
                    // تحديث معالج محفظة TON
                    if (window.tonWalletHandler) {
                        window.tonWalletHandler.walletAddress = wallet.account.address;
                        window.tonWalletHandler.publicKey = wallet.account.publicKey;
                        window.tonWalletHandler.isConnected = true;
                        
                        // معالجة الاتصال الناجح
                        window.tonWalletHandler.handleSuccessfulConnection(wallet);
                    }
                }
            });
            
            // حفظ مثيل TON Connect UI في نطاق عام
            window.tonConnectUI = tonConnectUI;
        });
        
        // التبديل بين شاشة تسجيل الدخول والمحتوى الرئيسي
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('smartcoin_auth_token') || 
                              localStorage.getItem('smartcoin_wallet');
            
            if (isLoggedIn) {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                
                // تحديث بيانات المستخدم
                const userData = JSON.parse(localStorage.getItem('smartcoin_user') || '{}');
                document.getElementById('user-name').textContent = userData.name || 'مستخدم';
                document.getElementById('welcome-user-name').textContent = userData.name || 'مستخدم';
                document.getElementById('user-balance').textContent = userData.balance || 0;
            } else {
                document.getElementById('loading-screen').style.display = 'flex';
                document.getElementById('main-content').style.display = 'none';
            }
        }
        
        // تسجيل الخروج
        document.getElementById('logout-btn')?.addEventListener('click', function(e) {
            e.preventDefault();
            
            // تسجيل الخروج من تليجرام
            if (window.telegramAuth) {
                window.telegramAuth.logout();
            }
            
            // تسجيل الخروج من محفظة TON
            if (window.tonWalletHandler) {
                window.tonWalletHandler.disconnectWallet();
            }
            
            // تسجيل الخروج من TON Connect UI
            if (window.tonConnectUI) {
                window.tonConnectUI.disconnect();
            }
            
            // إعادة تحميل الصفحة
            window.location.reload();
        });
        
        // التحقق من حالة تسجيل الدخول عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', checkLoginStatus);
    </script>
</body>
</html>

